# extends 'base.html'
# import 'macro/forms.html' as forms
# import 'macro/utils.html' as utils


# block content
  <div class="page-header">
    <div class="pull-right">
      # if post_db.user_key.id() == current_user.id
        <a class="btn btn-primary" href="{{url_for('post_update', post_id=post_db.key.id())}}">
          <span class="fa fa-fw fa-pencil"></span> Edit
        </a>
      # endif
    </div>
    <h1>
      # set user_db = post_db.user_key.get()
      <img class="img-thumbnail" src="{{user_db.avatar_url_size(96)}}" width="48" height="48">
      {{title}}
      <small>{{post_db.language_key.get().name}}</small>
      <small>
        by
        {{user_db.name}}
      </small>
    </h1>
  </div>

  <div class="row">
    <div class="col-xs-2">
      <form action="{{url_for('post_vote', post_id=post_db.key.id(), variant='a')}}">
        <button class="btn {{'btn-success' if (vote_db and vote_db.variant == 'a') else 'btn-default'}}">
          <span class="fa fa-fw fa-arrow-up"></span>
          {{votes_a}}
        </button>
      </form>
    </div>
    <div class="col-xs-10 text-right">
      <h3>Variant A</h3>
    </div>
  </div>
  # for v_db in vote_dbs if v_db.variant == 'a'
    # set user_db = v_db.user_key.get()
    <img class="img-thumbnail" src="{{user_db.avatar_url_size(64)}}" width="32" height="32" title="{{user_db.name}}">
  # endfor
  <pre><code class="{{post_db.language_key.get().slug}}">{{post_db.variant_a}}</code></pre>
  <hr>
  <div class="row">
    <div class="col-xs-2">
      <form class="form-inline" action="{{url_for('post_vote', post_id=post_db.key.id(), variant='b')}}">
        <button class="btn {{'btn-success' if vote_db and vote_db.variant == 'b' else 'btn-default'}}">
          <span class="fa fa-fw fa-arrow-up"></span>
          {{votes_b}}
        </button>
      </form>
    </div>
    <div class="col-xs-10 text-right">
      <h3>Variant B</h3>
    </div>
  </div>
  # for v_db in vote_dbs if v_db.variant == 'b'
    # set user_db = v_db.user_key.get()
    <img class="img-thumbnail" src="{{user_db.avatar_url_size(64)}}" width="32" height="32" title="{{user_db.name}}">
  # endfor
  <pre><code class="{{post_db.language_key.get().slug}}">{{post_db.variant_b}}</code></pre>

  <hr>
  <div class="anchor" id="comments"></div>
  <div class="row">
    <div class="col-md-offset-2 col-sm-8">
      # for comment_db in post_db.get_comment_dbs(limit=-1, order='created')[0]
        <div class="comment">
          <div class="content">
            {{comment_db.content.replace('\n', '<br>')|safe}}
          </div>
          <div class="meta">
            <time datetime="{{comment_db.created}}">
              {{comment_db.created.strftime('%Y-%m-%d')}}
            </time>
            <div class="user">
              # set user_db = comment_db.user_key.get()
              <img src="{{user_db.avatar_url_size(96)}}" width="18" height="18">
              {{user_db.name}}
            </div>
          </div>
        </div>
      # endfor
      <form method="POST" action="." novalidate>
        {{form.csrf_token}}
        # if form.content.errors
          <div class="form-group {{'has-error' if form.content.errors}}">
            {{form.content(class='form-control', rows=4, autofocus=True)}}
            {{forms.field_errors(form.content)}}
          </div>
        # else
          <div class="form-group">
            {{form.content(class='form-control', rows=4)}}
            <p class="help-block">Plain text only, markdown support is coming soon! Be gentle :)</p>
          </div>
        # endif
        <button type="submit" class="btn btn-primary btn-block btn-loading" {{forms.data_loading_text()}}>
          Comment
        </button>
      </form>
    </div>
  </div>
# endblock
